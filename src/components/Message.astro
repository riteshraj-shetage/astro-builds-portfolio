---
import Icon from "./Icon.astro";
---

<div class="card-highlight animate-fade-in-up" style="animation-delay: 0.2s">
  <div class="flex items-center mb-6 justify-between">
    <h3 class="text-2xl font-semibold text-gh-fg-default">Send a Message</h3>
  </div>
  <form
    action="https://api.web3forms.com/submit"
    method="POST"
    id="contactForm"
    class="space-y-5"
  >
    <!-- Web3Forms Access Key -->
    <input
      type="hidden"
      name="access_key"
      value={import.meta.env.PUBLIC_WEB3FORMS_ACCESS_KEY2}
    />

    <!-- Botcheck -->
    <input type="checkbox" name="botcheck" class="hidden" />

    <!-- Subject -->
    <input type="hidden" name="subject" value="New Portfolio Contact" />

    <!-- Name -->
    <div>
      <label
        for="name"
        class="block text-sm font-medium text-gh-fg-default mb-2"
      >
        Name
      </label>
      <input
        type="text"
        id="name"
        name="name"
        required
        class="w-full px-4 py-2.5 bg-gh-canvas-inset border border-gh-border-default rounded-md text-gh-fg-default transition-all"
        placeholder="Your name"
      />
    </div>

    <!-- Email -->
    <div>
      <label
        for="email"
        class="block text-sm font-medium text-gh-fg-default mb-2"
      >
        Email
      </label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full px-4 py-2.5 bg-gh-canvas-inset border border-gh-border-default rounded-md text-gh-fg-default transition-all"
        placeholder="your.email@example.com"
      />
    </div>

    <!-- Message -->
    <div>
      <label
        for="message"
        class="block text-sm font-medium text-gh-fg-default mb-2"
      >
        Message
      </label>
      <textarea
        id="message"
        name="message"
        rows="5"
        required
        class="w-full px-4 py-2.5 bg-gh-canvas-inset border border-gh-border-default rounded-md text-gh-fg-default resize-none transition-all"
        placeholder="Your message..."></textarea>
    </div>

    <!-- Submit -->
    <button type="submit" class="w-full btn btn-primary">
      <Icon name="paper-airplane" size={20} class="w-5 h-5" />
      Send Message
    </button>

    <!-- Result -->
    <div id="result" class="mt-4 text-center"></div>
  </form>
</div>

<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("contactForm");
    const result = document.getElementById("result");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!form.checkValidity()) return;

      const formData = new FormData(form);
      const json = JSON.stringify(Object.fromEntries(formData));

      result.innerHTML = "Sending...";
      result.className = "mt-4 text-center text-slate-400";

      try {
        const response = await fetch("https://api.web3forms.com/submit", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Accept: "application/json",
          },
          body: json,
        });

        const data = await response.json();

        if (response.status === 200) {
          result.classList.remove("text-slate-400");
          result.classList.add("text-gh-success-fg");
          result.innerHTML = "Thank you! Your message has been sent.";
        } else {
          result.classList.remove("text-slate-400");
          result.classList.add("text-gh-danger-fg");
          result.innerHTML = data.message;
        }
      } catch (error) {
        result.classList.remove("text-slate-400");
        result.classList.add("text-gh-danger-fg");
        result.innerHTML = "Something went wrong!";
      } finally {
        form.reset();
        setTimeout(() => {
          result.style.display = "none";
        }, 5000);
      }
    });
  });
</script>
