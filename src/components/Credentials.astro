---
import { credentials } from '../data/portfolio';
---

<section id="credentials" class="section">
  <div class="container-custom">
    <div class="section-header">
      <h2 class="section-title">Credentials & Certifications</h2>
      <p class="section-subtitle">Professional certifications and verified achievements</p>
    </div>

    <div class="max-w-5xl mx-auto space-y-6">
      {credentials.map((cred, index) => (
        <div class="card-highlight animate-fade-in-up" style={`animation-delay: ${index * 0.1}s`}>
          <div class="flex flex-col md:flex-row gap-6">
            {/* Certificate Image - 30% */}
            {cred.certificateImage && (
              <div class="md:w-[30%] flex-shrink-0 relative group cursor-pointer certificate-image-container"
                   data-cert-image={cred.certificateImage}
                   data-cert-title={cred.title}
                   data-cert-issuer={cred.issuer}
                   data-verification-url={cred.verificationUrl || ''}>
                <div class="relative overflow-hidden rounded-lg border border-gh-border-default bg-gh-canvas-subtle aspect-[4/3]">
                  <img 
                    src={cred.certificateImage}
                    alt={cred.title}
                    class="w-full h-full object-cover transition-transform group-hover:scale-105"
                  />
                  {/* Overlay with View button on hover */}
                  <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 transition-all flex items-center justify-center">
                    <button class="btn btn-secondary opacity-0 group-hover:opacity-100 transition-opacity transform scale-90 group-hover:scale-100">
                      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                      </svg>
                      View
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* Credential Info - 70% */}
            <div class="flex-1">
              <div class="flex flex-col md:flex-row md:items-start md:justify-between mb-3">
                <div>
                  <h3 class="text-xl font-semibold text-gh-fg-default mb-1">{cred.title}</h3>
                  <p class="text-gh-accent-fg font-medium">{cred.issuer}</p>
                </div>
                <div class="flex flex-col items-start md:items-end gap-2 mt-2 md:mt-0">
                  <span class="badge">{cred.date}</span>
                </div>
              </div>
              
              <p class="text-gh-fg-muted leading-relaxed mb-4">
                {cred.description}
              </p>

              {/* Related Skills Section */}
              {cred.relatedSkills && cred.relatedSkills.length > 0 && (
                <div class="mt-4 pt-4 border-t border-gh-border-default">
                  <h4 class="text-sm font-semibold text-gh-fg-muted mb-2 uppercase tracking-wide">Related Skills</h4>
                  <div class="flex flex-wrap gap-2">
                    {cred.relatedSkills.map((skill: string) => (
                      <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gh-accent-subtle text-gh-accent-fg border border-gh-accent-muted hover:bg-gh-accent-emphasis hover:text-white transition-colors">
                        {skill}
                      </span>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      ))}
    </div>

    <div class="mt-16 text-center">
      <div class="inline-flex items-center gap-3 px-6 py-3 bg-gh-canvas-subtle border border-gh-border-default rounded-lg">
        <svg class="w-6 h-6 text-gh-success-fg animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <span class="text-gh-fg-muted text-sm md:text-base">
          Continuously pursuing professional certifications and skill development
        </span>
      </div>
    </div>
  </div>
</section>

<!-- Certificate Modal -->
<div id="certificate-modal" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden items-center justify-center p-4">
  <div class="relative bg-gh-canvas-subtle rounded-lg w-[100%] md:w-[80%] h-auto md:h-[95vh] max-h-[95vh] overflow-auto flex flex-col items-center p-4 pt-8 pb-4">
    <!-- Overlayed Close Button (top-right) -->
    <button id="close-modal-btn" class="absolute top-3 right-3 text-gh-fg-muted hover:text-gh-fg-default transition-colors z-10 rounded-md">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <!-- Image (single clean area, no extra boxed sections) -->
    <img
      id="modal-certificate-image"
      src=""
      alt="Certificate"
      class="w-full object-contain rounded"
      style="max-height: calc(90vh - 85px);"
    />

    <!-- Verify Button (simple, unobtrusive, appears only when needed) -->
    <a
      id="modal-verify-btn"
      href="#"
      target="_blank"
      rel="noopener noreferrer"
      class="btn btn-secondary text-sm no-underline hidden mt-4 items-center z-10"
    >
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
      </svg>
      Verify
    </a>
  </div>
</div>

<script>
  // Modal functionality
  const modal = document.getElementById('certificate-modal');
  const modalImage = document.getElementById('modal-certificate-image') as HTMLImageElement;
  const modalVerifyBtn = document.getElementById('modal-verify-btn') as HTMLAnchorElement;
  const closeBtn = document.getElementById('close-modal-btn');
  const certificateContainers = document.querySelectorAll('.certificate-image-container');

  certificateContainers.forEach(container => {
    container.addEventListener('click', (e) => {
      const target = e.currentTarget as HTMLElement;
      const certImage = target.getAttribute('data-cert-image') || '';
      const verificationUrl = target.getAttribute('data-verification-url') || '';
      
      if (modalImage && modal && modalVerifyBtn) {
        modalImage.src = certImage;
        
        // Show or hide verify button based on whether verification URL exists
        if (verificationUrl) {
          modalVerifyBtn.href = verificationUrl;
          modalVerifyBtn.classList.remove('hidden');
        } else {
          modalVerifyBtn.classList.add('hidden');
        }
        
        modal.classList.remove('hidden');
        modal.classList.add('flex');
      }
    });
  });

  const closeModal = () => {
    if (modal) {
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }
  };

  if (closeBtn) {
    closeBtn.addEventListener('click', closeModal);
  }

  if (modal) {
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });
  }

  // Close modal on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {
      closeModal();
    }
  });
</script>
